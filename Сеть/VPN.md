https://www.youtube.com/watch?v=Vl21CIPME3M
# Вводная
#VPN - virtual private network.
VPN часто путают с прокси-серверами.
VPN - обобщенное название технологий позволяющих обеспечить одно или несколько сетевых соединений (логическую сеть) поверх другой сети (например интернет).
Например туннель GRE - [[Базовое туннелирование]].
В зависимости от применяемых протоколов VPN может обеспечивать соединения трех видов:
- узел-узел;
- узел-сеть;
- сеть-сеть;
Последние 2 вида более частые.

![[Pasted image 20250115102804.png]]
Site-to-site - позволяет соединить филиалы проброшенные через сеть провайдера или через сеть Internet. Таким образом можем использовать сеть для своего личного трафика, поднимать внутри динамическую типизацию и т.д. Однако передаваемые данные необходимо шифровать.
Remote/Roaming Users - удаленное подключение к рабочему месту, сервисам, файловой сети и т.д. Устанавливаете приложение, вбиваете адрес и подключаетесь к некой сети - аналогия с VMHorizon.

# Классификация по назначению
*Intranet VPN (Site-to-site*) - используют для объединения в единую защищенную сеть нескольких распределенных филиалов одной организации, обменивающихся данными по открытым каналам связи.

*Remote Access VPN* - используют для создания защищенного канала между сегментом корпоративной сети (центральный офис или филиал) и одиночным пользователем, который работая дома подключается к корпоративным ресурсам с домашнего компьютера, корп. компьютера, мини-пк.

*Extranet VPN* - используют для сетей, к которым подключаются внешние пользователи (заказчики или клиенты).

*Internet VPN* - используется для предоставления доступа к интернету провайдерами, обычно если по одному каналу подключаются несколько пользователей.
Протокол PPPoE стал стандартом ADSL подключений.

# Как работают VPN по OSI
![[Pasted image 20250115104036.png]]
L2TP организует туннель поверх IP, поверх 3-го уровня и переносит данные на 2-м уровне.

IPSec - работает на сетевом уровне.
SSL - работает на 4-м, 5-м уровнях и смежно.

# Протоколы VPN
Началось все с PPTP - старая архаичная версия протокола
## L2TP
Протокол туннелирования канального уровня. Объединяет протоколы L2F и PPTP. Позволяет организовывать VPN с заданными приоритетами доступа, однако не содержит в себе средств защиты и механизмов аутентификации.
Используют для сообщений двух типов:
- управляющие;
- информационные;
Управляющие сообщения используют для установления, поддержания и ликвидации туннелей и вызовов.
Информационные используют для инкапсулирования кадров PPP передаваемых по туннелю. При потере пакета он не передается повторно.
### Принцип работы
Проще смотреть видео

## IP Sec
 Набор протоколов, касающихся вопросов обеспечения защиты данных при транспортировке IP-пакетов. Включает в себя протоколы для защищенного обмена ключами в сети интернет. Протоколы работают на 3-м - сетевом уровне OSI.
 При использовании IPSec весь передаваемый трафик может быть защищен перед передачей по сети. При использовании IPSec получатель сообщения может отслеживать источник полученных пакетов и удостовериться в целостности данных. Необходимо быть уверенным, что транзакция осуществлялась один раз (за исключением когда необходимо повторить транзакцию). Это означает, что не должно существовать возможности записи транзакции и последующего ее повторения в записи с целью создания у пользователя впечатления об осуществлении нескольких транзакций.
### Принцип работы
Проще смотреть видео.
![[Pasted image 20250115112210.png]]
Тезисно есть два режима:
- транспортный - если нужно зашифровать данные не подменяя внешний IP адрес;
- туннельный - используется когда необходимо пробросить пакеты через сеть провайдера или через сеть Internet. Алгоритм работы сходен с GRE туннелированием; 
### Задачи IPSec
Виртуальная частная сеть между организациями;
Мобильный пользователь;
Пользователь SOHO;

IPSec VPN оптимален для объединения сетей разных офисов через интернет.
При использовании IPSec в связке с GRE можно обеспечивать связанность маршрутизаторов по протоколам динамической маршрутизации.

Часто используют связки GRE over IPSec и IPSec over GRE.

 ## SSL VPN/TLS
 SSL - secure socket layer, протокол защищенных сокетов, обеспечивающий безопасную передачу данных по сети интернет. 
 Встраивается между TCP и HTTPS.
 При его использовании создается защищенное соединение между клиентом и сервером.
 SSL использует защиту данных с открытым ключом для подтверждения подлинности передатчика и получателя. Поддерживает надежность передачи данных за счет использования корректирующих кодов и безопасных хэш-функций.
SSL bcgjkmpetn RC4, MD5, RSA и другие алгоритмы защиты данных. SSL использует два ключа для защиты данных:
- открытый;
- закрытый/частный известный только получателю сообщения;
На сегодняшний день в сети можно встретить множество сайтов использующих SSL для обеспечения безопасности пользовательских данных(веб-сайты предоставляющие коммерческие и банковские сервисы). Практически все самые популярные браузеры, почтовые клиенты, интернет приложения поддерживают работу с протоколом SSL. Для доступа к страницам, защищенным протоколом SSL, в URL вместо http используется https (порт 443).
### Принцип работы
Проще смотреть на видео

Необходимо более подробно узнать про ключи.
Допустим когда мы заходим в сеть и нас пытаются хакнуть через фишинг, злоумышленник надеется, что мы передадим свои данные, которые он использует для входа в настоящую сеть. 
Любой сайт передает сертификат, который наш клиент сравнивает в центре сертификации, действительно ли этот сертификат принадлежит сайту, за который этот сайт себя выдает, и если нет, то клиент нам сигнализирует, что соединение небезопасное.

Только если ключ совпадает с сертификатом, на страничке появляется замочек защищенного соединения.

![[Pasted image 20250115115544.png]]
В данном случае имеется никому неизвестный нигде не зарегистрированный сертификат, поэтому система ругается.
Траффик между устройствами шифрован, но шифрован тем ключом, которое предложило это устройство и про этот ключ больше никто не знает.

С SSH точно также, имеется открытый ключ и необходимо определиться, мы ему доверяем или нет.

## DMVPN
Технология упрощающая администрирование распределенных VPN-сетей, все более вытесняющая peer-to-peer VPN на основе IPSec.