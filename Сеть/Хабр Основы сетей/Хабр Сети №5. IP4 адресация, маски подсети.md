[Основа](https://habr.com/ru/articles/314484/)
# Введение
IP адрес - адрес используемый узлом на сетевом уровне имеет иерархическую структуру.
IP4 - состоит из 4 чисел называемых октетами и разделенных между собой точками - 193.233.44.12.
Каждый октет например *193* может принимать значение от 0 до 255. Всего 256 значений. Длина одного октета 8 бит. Суммарная длина IP4 адреса - 32 бита.

| 128 | 64  | 32  | 16  | 8   | 4   | 2   | 1   |
| --- | --- | --- | --- | --- | --- | --- | --- |
| x   | x   | x   | x   | x   | x   | x   | x   |

Вместо «x» записывается либо 1, либо 0. Таблица разделена на 8 колонок, каждая из которых несет в себе 1 бит (8 колонок = 8 бит = 1 октет). Расположены они по старшинству слева направо. То есть первый (левый) бит — самый старший и имеет номер 128, а последний (правый) — самый младший и имеет номер 1. Теперь объясню, откуда эти числа взялись. Так как система двоичная, и длина октета равна 8-ми битам, то каждое число получается возведением числа 2 в степень от 0 до 7. И каждая из полученных цифр записывается в таблицу от большего к меньшему. То есть слева направо. От 2 в 7-ой степени до 2 в 0-ой степени. Приведу таблицу степеней 2-ки.

![[Pasted image 20250803095843.png]]

Числа участвовавшие в формировании получат 1, остальные 0.
Например

| 128 | 64  | 32  | 16  | 8   | 4   | 2   | 1   | Итого |
| --- | --- | --- | --- | --- | --- | --- | --- | ----- |
| 1   | 1   | 0   | 1   | 0   | 1   | 0   | 1   | 213   |
| 1   | 0   | 1   | 1   | 0   | 1   | 0   | 0   | 180   |
| 1   | 1   | 0   | 0   | 0   | 0   | 0   | 1   | 193   |
| 0   | 0   | 0   | 0   | 0   | 0   | 1   | 1   | 3     |
Итого получившийся адрес 213.180.193.3

# Историческая часть №1
IP-адреса нужно как-то сгруппировать и контролировать выдачу. Решением было разделить все пространство IP-адресов на классы. Это решение получило название **классовая адресация (от англ. Classful)**. Она уже давно устарела и не используется, но нужна для понимания:
![[Pasted image 20250803100631.png]]
## Класс А
Этому блоку дан самый большой блок адресов, а если быть точным, то половина всего адресного пространства. Предназначался данный класс для крупных сетей.
![[Pasted image 20250803101034.png]]
Первый октет, то есть 8 бит, остаются за адресом сети, а 3 последних октета (то есть оставшиеся 24 бита) назначаются хостам. Вот для того, чтобы показать, какой кусок относится к сети, а какой к хостам, используется **маска**.
### Маска
Отличие маски от IP-адресов в том, что 0 и 1 не могут чередоваться. Сначала идут 1, а потом 0. Таким образом, там где есть единица, значит это участок сети. Чуть ниже, после разбора классов, я покажу, как с ней работать. Сейчас главное знать, что маска класса A — 255.0.0.0. 

| 128 | 64  | 32  | 16  | 8   | 4   | 2   | 1   | Итого |
| --- | --- | --- | --- | --- | --- | --- | --- | ----- |
| 1   | 1   | 0   | 0   | 0   | 0   | 0   | 1   | 255   |
В таблице еще упомянут какой-то первый бит и для класса A он равен 0. Этот бит как раз нужен для того, чтобы сетевое устройство понимало, к какому классу оно принадлежит. Он же еще задает начальный и конечный диапазон адресов. Если в двоичном виде записать на всех октетах единицы, кроме первого бита в первом октете (там всегда 0), то получится 127.255.255.255, что является границей класса A. Например, возьмем адрес 44.58.63.132. Мы знаем, что у класса A первый октет отдается под адрес сети. То есть «44» — это адрес сети, а «58.63.132» — это адрес хоста.
## Класс B
![[Pasted image 20250803101520.png]]
Этому классу был дан блок поменьше. И адреса из этого блока предназначались для сетей средних масштабов. 2 октета отданы под адрес сети, и 2 — под адрес хостов. Маска у B класса — 255.255.0.0. Первые биты строго 10. А остальные меняются. Перейдем к примеру: 172.16.105.32. Два первых октета под адрес сети — «172.16». А 3-ий и 4-ый под адрес хоста — «105.32».
## Класс C
![[Pasted image 20250803101613.png]]
Этот класс обделили адресами и дали ему самый маленький блок. Он был предназначен для мелких сетей. Зато этот класс отдавал целых 3 октета под адрес сети и только 1 октет — под хосты. Маска у него — 255.255.255.0. Первые биты 110. На примере это выглядит так — 192.168.1.5. Адрес сети «192.168.1», а адрес хоста «5».
## Класс D и E
Адреса из этих блоков зарезервированы и не могут назначаться сетям и хостам. Класс D предназначен для многоадресной рассылки. Аналогию можно привести с телевидением. Телеканал вещает группе лиц свой эфир.
А первые биты у класса E — это 1111. Поэтому, если вдруг увидите адрес вида 240.0.0.1, смело говорите, что это адрес E класса.
# А зачем нужны маски?
Теперь озвучу вопрос, который мне недавно задали. Так зачем тогда маски? У нас итак хосты понимают в каком они классе. Но суть вот в чем. Например, у вас есть маленький офис, и вам нужен блок IP-адресов. Никто не будет вам выдавать все адреса класса C. А дадут только его кусок. Например 192.168.1.0 с маской 255.255.255.0. Так вот эта маска и будет определять вашу границу. Мы уже говорили, что октет варьируется в значении от 0 до 255. Вот этот 4 октет полностью в вашем распоряжении. За исключением первого адреса и последнего, то есть 0 и 255 в данном случае. Первый адрес — это адрес сети (в данном случае 192.168.1.0), а последний адрес — широковещательный адрес (192.168.1.255). Напомню, что широковещательный адрес используется в том случае, когда надо передать информацию всем узлам в сети. Поэтому есть правило. Если вам надо узнать номер сети, то все биты относящиеся к хосту обращаете в 0, а если широковещательный, то все биты — в 1.

![[Pasted image 20250803102112.png]]Я записал адрес класса C 192.168.1.1 с маской 255.255.255.0 в десятичном и двоичном формате. Обратите внимание на то, как выглядит IP-адрес и маска в двоичном формате. Если в IP-адресе 0 и 1 чередуются, то в маске сначала идут 1, а потом 0. Эти биты фиксируют адрес сети и задают размер. По таблице выше можно сделать вывод, что в двоичном виде маска представлена последовательностью 24 единиц подряд. Это говорит о том, что целых 3 октета выделено под сеть, а 4 октет свободен под адресацию для хостов. Здесь ничего необычного. Это стандартная маска класса C.

## Подсеть - история создания
Например, в вашем офисе 100 компьютеров, и расширяться вы не планируете. Зачем плодить сеть из 250+ адресов, которые вам не нужны?! На помощь приходит разделение на подсети.
Объясню принцип на примере того же класса C. Как бы вы не хотели, но трогать 3 октета нельзя. Они фиксированы. Но вот 4 октет свободен под хосты, поэтому его можно трогать. Заимствуя биты из хостового куска, вы дробите сеть на n-ое количество подсетей и, соответственно, уменьшаете в ней количество адресов для хостов.

Попробуем это воплотить в реальность. Меняю маску. Заимствую первый бит из хостовой части(то есть 1-ый бит 4-ого октета выставляю в единицу). Получается следующая маска.
![[Pasted image 20250803103434.png]]

Данная маска делит сеть на 2 части. Если до дробления у сети было 256 адресов(от 0 до 255), то после дробления у каждого куска будет по 128 адресов(от 0 до 127 и от 128 до 255).  
Теперь посмотрю, что изменится в целом с адресами.
![[Pasted image 20250803103602.png]]
Красным цветом я показал те биты, которые зафиксированы и не могут изменяться. То есть маска ей задает границу. Соответственно биты помеченные черным цветом определены для адресации хостов. Теперь вычислю эту границу. Чтобы определить начало, надо все свободные биты(помеченные черным цветом) обратить в ноль, а для определения конца обратить в единицы. Приступаю.
![[Pasted image 20250803103743.png]]
То есть в четвертом октете меняются все биты, кроме первого. Он жестко фиксирован в рамках этой сети.  
  
Теперь посмотрим на вторую половину сети и вычислим ее адреса. Деление у нас производилось заимствованием первого бита в 4-ом октете, значит он является делителем. Первая половина сети получалась, когда этот бит принимал значение 0, а значит вторая сеть образуется, когда этот бит примет значение 1. Обращаю этот бит в 1 и посмотрю на границы.
![[Pasted image 20250803104111.png]]
Приведу в десятичный вид.  
![](https://habrastorage.org/r/w1560/files/600/97d/719/60097d71927d4ac9be95b8dadee07798.PNG)

Соответственно .128 и .255 назначать хостам нельзя. Значит в доступности 128-2=126 адресов.  
Вот таким образом можно при помощи маски управлять размером сети. Каждый заимствованный бит делит сеть на 2 части. Если откусить 1 бит от хостовой части, то поделим на 2 части (по 128 адресов), 2 бита = 4 части (по 64 адреса), 3 бита = 8 (по 32 адреса) и так далее.
## Историческая часть №2
Главное условие, при использовании классовой адресации (классы из исторической части №1) — это то, что должна использоваться одна маска для всех подсетей. То есть, если у вас для одной подсети маска 255.255.255.0, то для другой подсети она не может быть 255.255.255.128.

# Когда масок стало не хватать
Классовая адресация — это зарождение сегодняшнего интернета, и именно с нее все началось. Поэтому плюсов у нее много, и за это создателям спасибо. Но, как вы могли заметить, у нее было жесткая привязка к одной маске. За счет этого IP-адреса использовались не экономно и расточительно. А в связи с бурным ростом Интернета адресов стало не хватать, и срочно нужно было вносить изменения. 

Поняли ведущие умы, что использовать классовые сети не удобно и нужно от них отказываться. Это привело к созданию бесклассовой адресации и маскам переменной длины.

## Пару слов о видах IP-адресов
[основа от Selectel](https://selectel.ru/blog/white-and-grey-ip/)
Несмотря на то, что переход от классовой адресации к бесклассовой предполагал экономию IP-адресов, на деле эта проблема все равно решалась не полностью. Все упиралось в саму технологию IPv4. Объясню почему. Выше я говорил, что длина IP адреса равна 32 бита. Каждый бит может принимать значение 0 или 1, то есть два значения. Соответственно, чтобы вычислить все комбинации, надо возвести 2 в 32-ую степень. Получаем 4294967296 адресов. Если вычесть отсюда зарезервированные для специальных нужд и прочего, то останется примерно 4.2 млрд. адресов, когда на Земле проживает около 7.3 млрд. человек. Поэтому ведущие умы быстро просекли эту фишку и начали искать решение. Они решили выделить некое адресное пространство, которое будет использоваться только в пределах локальной сети и не будет использоваться в Интернете. Это разделило адреса на 2 лагеря: белые или публичные (англ. public) и серые или частные (англ. private).


### Белый адрес
Публичный IP-адрес чаще называют «белым». С его помощью устройство может беспрепятственно выходить в интернет и общаться с другими устройствами, которые также обладают белым IP-адресом.

Только белые IP-адреса могут существовать в интернете. Это значит, что любой веб-сервис или сервер, на котором запущена любимая игра, имеют белый IP-адрес. А в некоторых случаях даже несколько — для дополнительной защиты на случай, если с первым адресом что-либо произойдет.

Кроме того, благодаря наличию белого IP-адреса пользователям открываются такие возможности, как подключение PPTP, OpenVPN, IPSec, FTP-сервера, сетевого хранилища и других технологий и сервисов.
### Серый адрес
Диапазон адресов, которые выделены под локальные сети:  
- 10.0.0.0 – 10.255.255.255 с маской 255.0.0.0 (или кратко 10/8);
- 172.16.0.0 – 172.31.255.255 с маской 255.240.0.0 (или кратко 172.16/12);
- 192.168.0.0 – 192.168.255.255 с маской 255.255.0.0 (или кратко 192.168/16);
- 100.64.0.0 – 100.127.255.255 с маской 255.192.0.0 (RFC6598 рекомендует использовать данную подсеть для использования в качестве адресов для CG-NAT).
Если честно, я мало где видел применение адресации 172.16.X.X. Обычно в корпоративной среде всегда используется 10.X.X.X, а в домах/квартирах и мелких офисах 192.168.X.X.

Когда мы из локальной сети отправляем сообщение на адрес и маршрутизатор видит, что адрес не из локальной сети, он подменяет серый адрес, на белый. При помощи NAT протокола.

Блокировка белого IP адреса распространяется на всех пользователей внутри локальной сети.
#### Адреса исключения
1) 0.0.0.0/8 — диапазон адресов, используемый хостами для самоидентификации. 
2) 127.0.0.0/8 — loopback или localhost адреса. Это IP-адреса, используемые компьютером, чтобы обратиться к самому себе. Очень полезно для проверки работы TCP/IP. Дело в том, что независимо от наличия соединения с Интернетом или локальной сетью, адреса из этого пула должны всегда пинговаться. Если этого не происходит, значит система накрылась или накрывается медным тазом.  
3) 169.254.0.0/16 — link-local address или локальные адреса. Автоматически используются хостами при отсутствии DHCP-сервера или его недоступности. Это позволяет быстро организовать локальную сеть и проверить работу узлов. Однако данный пул адресов не маршрутизируется. Следовательно, выйти в Интернет с них не получится.  
  
4) 224.0.0.0/4 — блок адресов, зарезервированный под многоадресную рассылку или multicast. Для тех, кто хочет побольше узнать про multicast, оставляю [ссылку](https://tools.ietf.org/html/rfc3171).

#### Как узнать свой IP
Windows - cmd - ipconfig
![[Pasted image 20250805073252.png]]
IPv4 - локальный айпишник
#### Динамический адрес
Динамические адреса — это адреса, который меняются каждый раз при подключении к маршрутизатору. Например, вы ушли из дома и отключили телефон от сети Wi-Fi. Роутер увидел, что больше тот IP-адрес никто не занимает и возвращает его в пул свободных адресов для выдачи. Когда вы вернетесь домой и снова подключитесь к Wi-Fi, роутер назначит устройству новый адрес (а, возможно, тот же самый, если он будет свободен и будет его «очередь»).

Статические адреса, наоборот, закрепляются за одним устройством и не меняются с течением времени или количеством подключений к сети.
## Снова о бесклассовых масках
### CIDR нотация
Автор приводит запись масок в CIDR нотации
192.168.1.0/24 - как понять, где здесь маска? Маска здесь 24, что означает, что первые 24 бита относятся к адресу сети, а остальное к хостам и определен размер сети.

![[Pasted image 20250805075510.png]]

#### Как понять, где маска?
- **/24** означает, что первые **24 бита** в IP-адресе относятся к **адресу сети**, а оставшиеся **8 бит** (32 - 24 = 8) — к **хостам**.
- В традиционной форме (десятичной) маска выглядит как:  
    **255.255.255.0**
####  Диапазон хостов в сети 192.168.1.0/24
- **Адрес сети:** `192.168.1.0`
- **Первый доступный хост:** `192.168.1.1`
- **Последний доступный хост:** `192.168.1.254`
- **Broadcast-адрес:** `192.168.1.255`
####  Как это считается?
- В маске `/24` последний октет (`.0`) может меняться от **1** до **254** (`.255` — broadcast).
- Всего хостов: **254** (2⁸ - 2 = 256 - 2).
### Задача по сетям
Представим ситуацию. Вам выдали сеть 192.168.1.0/24 и поставили следующие условия:  
  
1) Подсеть на 10 адресов для гостей.  
2) Подсеть на 42 адреса для сотрудников.  
3) Подсеть на 2 адреса для соединения 2 маршрутизаторов.  
4) Подсеть на 26 адресов для филиала.

Ок. Данная маска показывает, что в нашем распоряжении находятся 256 адресов. По условию эту сеть надо каким-то образом разделить на 4 подсети. Давайте попробуем. 256 очень хорошо делится на 4, давая в ответе 64. Значит один большой блок в 256 адресов можно поделить на 4 равных блока по 64 адреса в каждом. И все было бы прекрасно, но это порождает большое число пустых адресов. Для сотрудников, которым нужно 42 адреса, ладно, может в дальнейшем компания еще наймет. Но вот подсеть для маршрутизаторов, которая требует всего 2 адреса, оставит 60 пустых адресов. Да, вы можете сказать, что это private адреса, и кому дело до них. А теперь представьте, что это публичные адреса, которые маршрутизируются в Интернете. Их и так мало, а тут мы еще будем их отбрасывать. Это не дело, тем более, когда мы можем гибко управлять адресным пространством. Поэтому возвращаемся к примеру и нарежем подсети так, как нам нужно.

Нерациальное распределение пространства
![[Pasted image 20250805075941.png]]

Рациональное распределение пространства
![[Pasted image 20250805075952.png]]
Механизм деления на подсети с разной маской получил название **VLSM (от англ. Variable Length Subnet Mask)** или **маска подсети переменной длины**.

