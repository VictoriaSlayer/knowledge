# Общая инфа
https://www.youtube.com/watch?v=2B-n9EBK5m4
Туннелирование позволяет пробрасывать информацию между двумя узлами сети не ставя в известность сеть, что мы через неё прокидываем. Таким образом можно обходить различные блокировки.
Достигается это посредством того, что информация о передаваемой информации между участками сети инкапсулируется - содержимое передаваемого пакета скрывается от сети. То есть мы не ставим сеть в известность о том, что именно мы передаем. Сеть передает письмо, но письмо с гербовой печатью и она его не вскрывает.

Базовое туннелирование - протокол GRE. Позволяет через L3 соединение (маршрутизатор) пробросить виртуальные каналы (тунели) на L2 уровень узлов.
GRE - протокол 47. Не всякий провайдер разрешит его использовать, он будет их резать и запрещать туннелирование.
Туннель GRE не шифрованный.
![[Pasted image 20250115075616.png]]
L3 уровень - транспортный уровень сети. На L3 находятся маршрутизаторы.
L2 уровень - канальный уровень сети. На нем находятся узлы.

Маршрутизаторы L3 связывают участки сети L2 между собой образуя один сегмент сети.

Устанавливая виртуальное соединение мы словно напрямую соединяем участки сети между собой, словно нет маршрутизатора (возможно говорится про прозрачный мост).
Имея виртуальное (прямое соединение) между участками сети мы можем поднять динамической протокол маршрутизации (когда таблица маршрутизации определяется автоматически, а не вручную). 

# Как работает туннелирование?
Текста много, можно посмотреть видео, но там нужно погружаться в контекст, чтобы нормально понять.

Контекст.
У нас есть отправитель - сеть 200
![[Pasted image 20250115081346.png]]
и приемник - сеть 100
![[Pasted image 20250115081402.png]]

Мы передаем пакет из 200 в 100.
Каждый из них подключен к своему маршрутизатору:
приемник к маршутизатору R2
![[Pasted image 20250115081440.png]]
отправитель к R1
![[Pasted image 20250115081509.png]]

Маршрутизаторы соединены в некую сеть - Globbal IP Network.
![[Pasted image 20250115082303.png]]

А вот IP пакет информации который необходимо передать от 200 к 100.
![[Pasted image 20250115082355.png]]
S - sourse, адрес источника.
D - destination, адрес назначения.
В данном случае используемые протоколы слева направо:
IP (S, D) - TCP - HTTP

Мы  передаем IP пакет через TCP на транспортном уровне, HTTP на прикладном уровне. 

Мы собираемся передавать этот пакет через GRE туннель, чтобы сеть не имела представление о том, что мы передаем. Как это происходит?
![[Pasted image 20250115083937.png]]
К нашему исходному пакету (1) прикрепляется GRE заголовок (2). А к GRE заголовку прикрепляется новый IP заголовок (3), в котором указаны интерфейсы маршрутизаторов источника R2 и отправителя R1.
![[Pasted image 20250115084028.png]]
Таким образом заголовки 1 будут отвечать только за перенос от R2 к R1. При этом предполагается, что Global IP Network через которую мы все это дело передаем, в курсе о существовании обоих маршрутизаторов.

После того как пакет передался из R2 в R1, R1 сбрасывает внешний IP заголовок
![[Pasted image 20250115084318.png]]
Снимает GRE туннель
![[Pasted image 20250115084403.png]]
И далее уже R1 отправляет распакованный пакет в сеть назначения приемник - сеть 100
![[Pasted image 20250115081402.png]]
R1 - 100.

Таким образом сети приемник и отправитель не объявляясь в глобальной сети работают через GRE туннель - туннельный интерфейс.
![[Pasted image 20250115084625.png]]
GRE туннель не обеспечивает надежное шифрование и его легко можно взломать.
![[Pasted image 20250115085402.png]]

GRE заголовок помечается протоколом 47. Который будет содержаться в новом IP пакете сверху.
В картинке выше, верхняя строчка - With Pure IP - исходный IP пакет, который обворачивается GRE и потом еще сверху новым IP пакетом.

Здесь описан случай в контексте одного туннеля, а если множество соединений, то наступает динамическая маршрутизация с туннелировванием.
Условно можно сказать, что туннель разновидность VPN
# Как настраивать туннели
Смотри видео, там проще.