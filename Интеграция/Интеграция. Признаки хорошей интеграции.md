[[Интеграция. Технологии.canvas | Обязательно здесь смотри условия интеграции]]

[Часть 1](https://habr.com/ru/companies/oleg-bunin/articles/534090/)
[Часть 2](https://habr.com/ru/companies/oleg-bunin/articles/538156/)
[Часть 3](https://habr.com/ru/companies/oleg-bunin/articles/543946/)
# Часть 1. Поддержка
1. Интеграция работает быстро, без ошибок.
2. Админка позволяет отлавливать различные ошибки:
	1. При ошибке работа не останавливается;
	2. 
3. Контроль последовательности обработки сообщений.
4. Возможность глянуть транзакцию, которая будет отправляться.
5. Согласованность систем (обновление данных в системах и т.д.).
6. При изменении объектов:
	1. желательно видеть в интерфейсе изменения, которые вносит сообщение в существующий объект;
	2. возможность изменить объект вручную средствами системы;
7. Возможность проводить откаты в системе источнике и системе приемнике.
8. Сверка данных (автоматически или по запросу).
9. Уведомления об ошибках

# Часть 2. Идемпотентные операции
Проблематика - если что-то пошло не так, во время передачи данных,. но мы не знаем, что, будет неплохо, если наше повторное действие будет *идемпотентно* и не вызовет *дублирования* операции или данных соответственно.
## Как реализовывать идемпотентные операции
Как же должна быть устроена, например, обработка платежей, чтобы обеспечивать идемпотентность? Отправляющая система должна нумеровать каждый платеж уникальным номером. Принимающая система на обработке платежа должна проверять — возможно, платеж с таким номером уже приходил раньше, и мы имеем дело с дублем сообщения. Если нет — создавать новый платеж. Если же платеж уже существует, и его атрибуты совпадают — выдавать текущий статус обработки. А при различии атрибутов, — когда с тем же самым номером пришел другой платеж — выдавать ошибку.

Замечу, что это важная часть шаблона — сверить атрибуты создаваемого платежа при обнаружении, что платеж с таким номером уже есть.

Необходима идентификация сущностей.
Алгоритм обработки транзакций с учетом идемпотентности на обеих сторонах.
## Важное примечание
*ВООБЩЕ это все похоже на работу протоколов TCP/IP.* Также необходимо посмотреть книгу Алекса Сюя, возможно там было что-то подобное. В случае необходимости я думаю там можно подсмотреть алгоритм работы, когда столкнешься с необходимостью.

# Часть 3. Синхронное, асинхронное, реактивное взаимодействие
Самая тяжелая часть. Не хватает знаний.
Тезисно:
- если есть возможность избавиться от синхронного взаимодействия - избавляйтесь. Уходите в сторону асинхронного с логами. В случае возникновения ошибок по логам будет проще разобраться.
- Транзакционность в системах - отдельная история, с ней придется плотно разбираться, множество механизмов, все разные.
- Персистентность - структуры данных, которые при внесении в них изменений сохраняют доступ ко всем своим предыдущим состояния. Необходимо понимать - возможно это или нет;
