[[SQL Процедуры]]
Системный каталог состоит из таблиц описывающих структуру объектов базы данных, таких как базы данных, базовые таблицы, представления, индексы, сущности. Эти таблицы называются системными базовыми таблицами. Компонент Database Engine часто обращается к системному каталогу за информацией необходимой для правильного функционирования системы.
Для обращения за информацией к системным базовым таблицам можно использовать несколько разных интерфейсов
![[Pasted image 20240414200241.png]]
В уроке рассматриваются инструменты из
- Catalog views
- System Procedures

### Представление каталога
![[Pasted image 20240414200503.png]]
Представление о каталогах относится к схеме sys.

#### sys.objects
Select * from sys.objects
Представление общей информации всех сущностях которые есть в нашей БД.
Показывает как системные сущности, так и сущности, которые мы создали в процессе работы.
![[Pasted image 20240414201449.png]]
Необходимо обращаться на ресурс MSDN чтобы расшифровывать эти сущности.
В столбце type указан тип сущности (таблица, представление и т.д.).

select * from sys.objects
where type = 'U'

#### Получить информацию о всех созданных в БД сущностях
Select * from sys.objects
where schema_id = schema_id('dbo')

#### Получить информацию по всем таблицам
Select * from sys.tables

#### Получить информацию о представлениях
Select * from sys.views

#### Получить информацию о триггерах
Select * from sys.triggers

#### Получить информацию о системных процедурах
Select * from sys.procedures

### Системные процедуры
Для работы с процедурами используется ключевое слово EXEC.
Системных процедур много, на курсе перечислены лишь некоторые.
По сути это те же функции, но со своим синтаксисом. И аргументы в них передаются не через скобки, а через кавычки, получается так, что необходимо смотреть синтаксис процедуры.
![[Pasted image 20240414211511.png]]

#### EXEC sp_help
можно вызвать также при помощи клавиш alt + f1
![[Pasted image 20240414211650.png]]

!!! exec sp_help 'имя__таблицы'
выдает всю информацию о таблице
#### ВАЖНО
!!!ВАЖНО можно посмотреть всю инфу по таблице сразу
![[Pasted image 20240414212532.png]]

#### exec sp_tables
Получаем всю информацию и представления о всех таблицах которые есть в базе

exec sp_tables @table_owner = 'dbo' - показать все таблицы, где владелец dbo.

#### exec sp_columns
можем выполнить только с заполненным параметром - table_name
Выводит информацию о колонках.
exec sp_columns 'students'

#### exec sp_pkeys
Информация о первичных ключах
exec sp_pkeys 'students'

#### ВАЖНО
#### exec sp_depends
Показывает связи зависимости какого либо объекта, в том числе таблицы, как они связаны.
![[Pasted image 20240414213535.png]]


### Агрегатные функции
Выполняют вычисление на наборе значений и возвращают одиночное значение. Агрегатные функции за исколючением COUNT не учитывают NULL.

![[Pasted image 20240414213713.png]]
При использовании агрегатных функций желательно задавать псевдонимы для столбцов, так как они не будут брать название столбца по которому использовали функцию
#### SUM()
Посчитать общую сумму
Select sum(имя_столбца) имя_псевдонима_столбца from имя_таблицы

##### Sum по определенному столбцу
сделать отбор при помощи SUM() по определенному столбцу
Select sum(имя_столбца) имя_псевдонима_столбца from имя_таблицы
group by имя_столбца1, имя_столбца2

##### Вывести только те продукты, чье общее количество продаж больше 10 штук
Select sum(имя_столбца1) имя_псевдонима from имя_таблицы
where имя_столбца2 is not null and sum(имя_столбца1) > 10
group by имя_столбца3
having sum(имя_столбца1) > 10

запрос сложный, т.к. очередность приоритетов команд

#### min, max
вывести минимальное, максимально число по каждому столбцу
select имя_столбца_по_которому_отбор, min(имя_столбца2) имя_псевдонима1, max(имя_столбца2) имя_псевдонима2 from имя_таблицы

#### avg()
avg(имя_столбца)
Находит среднее значение в определенном столбце. Однако слепо на формулу рассчитывать не всегда стоит, необходимо ориентироваться на формулы статистики. Поэтому не сильно рассчитываем.

#### count()
подсчитывает количество записей, строк в определенной таблице, определенном столбце.
select count(звездочка) from имя_таблицы - подсчитывает общее количество строк в таблице

select count(имя_столбца) from имя_таблицы - подсчитывает общее количество строк по столбцу

select count(distinct имя_столбца) from имя_таблицы - узнать общее количество уникальных столбцов

select count(distinct имя_столбца1) имя_псевдонима1,
count(distinct имя_столбца2) имя_псевдонима2
from имя_таблицы