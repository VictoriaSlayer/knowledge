База данных - информация об объектах, которая организована специальным образом
### Нереляционные СУБД
Nosql - not only SQL
Если нужна БД, которая не вмещается на один компьютер, то тогда нужна кластеризация. С кластерами все не гладко, обеспечивать целостность данных тяжело. Мы жертвуем возможностью составлять сложные запросы, но появляется возможность простого масштабирования. 
#### Парадигмы NoSQL
Имеются различные парадигмы среди которых
Map reduce
tarantool (все данные лежат в оперативе, получаем очень быстрый отклик)

### Реляционные СУБД
Реляционная модель данных строится на базе отношений (упрощено таблиц).
![[Pasted image 20240615104708.png]]

#### Устройство СУБД
Имеются Типы Данных, каждый столбик имеет определенный тип - строка, целое, булево.
Атрибут - название столбца.
Домен - более узкоспециализированный тип данных, который удовлетворяет определенному условию. Или по другому
Домен - набор значений, допустимых для ввода в столбец (номер телефона, размер снегоступов и т.д.).
Кортеж - строка. Множества пар {атрибут, значение}, которое содержит одно вхождение каждого имени атрибута, принадлежащего схеме отношения.
Множественные кортежи определенного типа это отношения. Отношения не имеют внутри себя определенного порядка. А внутри таблицы они есть.
Целостность базы данных - соответствие имеющейся в базе данных информации её внутренней логике, структуре и всем явно заданным правилам.

В любой момент времени порядок данных возвращаемый СУБД в качестве ответа может поменяться, если он не задан в явном виде.

Ограничения по СУБД могут быть в рамках одного Кортежа (Премия не может быть больше оклада), в рамках Атрибута (имя должно быть всегда), ограничения на уникальность. Ограничения связывающие отношения (если есть дети, то должны быть и родители).

Реляционная модель данных - логическая модель данных, теория построения баз данных, которая является приложением к задачам обработки данных следующих разделов математики - теория множества, логика первого порядка.

РМД имеет следующие компоненты:
- структурный аспект - данные в БД представляют набор отношений;
- целостный аспект - таблицы отвечают определенным условия целостности. РМД поддерживает декларативные ограничения целостности уровня домена (подтипа данных), уровня отношения и уровня БД;

Пример целостного аспекта - у нас условие, что в Кортеже всегда должно быть заполнено имя. Но проверить уникальность имени в Кортеже уже сложнее гораздо.

- аспект обработки (манипулирования) - РМД поддерживает операторы манипулирования отношениями (реляционная алгебра, реляционное исчисление). Иными словами изменение в БД - изменение данных, структуры отношений, самой БД;
Реляционная алгебра - вид алгебры отвечающий за запросы к БД (выборка, проекция, объединение, пересечение, разности, произведение, деление, соединение). Любой SQL запрос это вид реляционной БД.

![[Pasted image 20240615110759.png]]

Проекция - отсекаем столбцы
![[Pasted image 20240615110853.png]]

Пересечение
![[Pasted image 20240615111102.png]]

Язык SQL декларативен, мы говорим, что хотим получить и СУБД сама решает как выполнить этот запрос (при помощи реляционной алгебры). Мы можем повлиять на работу СУБД, но не напрямую. Поэтому информация о том какая часть запроса в каком порядке выполняется лишен смысла.

![[Pasted image 20240615111814.png]]

### Виды ключей
*Потенциальный ключ* - атрибут или группа атрибутов удовлетворяющих условию, что они уникальны и минимальны.

Уникальность - не существует двух кортежей данного отношения, в которых значения этого подмножества атрибутов совпадают.

Минимальность - в составе потенциального ключа отсутствует меньшее подмножество атрибутов удовлетворяющее условию уникальности. Иными словами, если из  потенциального ключа убрать атрибут, он утратит уникальность.

*Primary key/Первичный ключ* - в РМД один из потенциальных ключей отношения, выбранный в качестве основного ключа. Если в отношении имеется единственный потенциальный ключ, он является и первичным ключом. Если потенциальных ключей несколько, один выбирается в качестве первичного, другие в качестве альтернативного.
(ИНН, номер паспорта, СНИЛС и т.д.)

Суррогатный/альтернативный ключ - сами присваиваем кортежу ID. Если мы не хотим первичный ключ использовать в качестве ID.

![[Pasted image 20240615113832.png]]

СУБД любят когда записи упорядочиваются по первичному ключу.

### Типы данных PostgreSQL
Числовые
Строковые
Календарные
NULL
Отдельная история - JSON, XML, географическое положение и т.д.

В реляционных СУБД если не сказано явно любое поле может быть NULL.

У SQL есть несколько стандартов, в стандартах описаны значения типов. В зависимости от СУБД есть стандартные типы, есть нестандартные, в зависимости от потребностей.
У типов есть фиксированный и нефиксированный размер. Например - Numeric (количество цифр после запятой).

### ER модель
Способ отражения данных на блок схемах
![[Pasted image 20240615121451.png]]
Таблицы и между ними ссылки.

Принцип в начале схема БД, потом таблицы не очень жизнеспособен, т.к. с развитием БД часто требуется добавлять в неё какие либо данные которые не были изначально в неё заложены.
Создают новую БД, но старая БД при этом рушится, т.к. рушатся связи и начинается правка БД.

DDL запросы используются для того, чтобы определить, что будет в базе лежать.
![[Pasted image 20240615121928.png]]

### Версионирование БД
Переход старой версии БД к новой версии БД называется миграцией.
Проблемы миграции сводятся к тому, что люди хотят сохранить данные. 

Нужна возможность создать БД с нуля, нужна возможность быстрых переходов между версиями БД, нужна возможность отката БД, нужна возможность свести ручное редактирование БД при слиянии к минимуму.

Один из вариантов решения:
#### Генерация БД на базе исходного кода
Плюсы:
- удобно наблюдать изменения в структуре между версиями при помощи контроля версий;
- как и любой код Структуру БД удобно комментировать;
- Для создания с нуля чистой базы необходимо выполнить один файл;
- Команды миграции более надежны чем в других методах, т.к. генерируются автоматически;
- Мигрировать с новых версий на старые почти так же просто, как со старых на новые;
- В случае слияния двух веток репозитория Merge осуществляется проще чем при использовании других методов;
Минусы:
- изменения данных придется хранить отдельно, и затем вручную вставлять в сгенерированные скрипты-миграции;
- Вручную выполнять миграции очень неудобно, необходимы автоматизированные средства;

##### Метод инкрементальных изменений
Например захотели добавить отдельный столбец, пишем SQL файл руками
![[Pasted image 20240615165844.png]]

Нам не важно какие были игровые шмотки 3 версии назад. Мы их выкидываем и ставим новые.
Если кто-то пытается запустить старый сервер с новой версией БД, то обычно это приводит к печальным последствиям.

Плюсы:
- Быстрое и удобное выполнение миграции до последней версии;
- Механизм нумерации версий. Номер текущей версии хранится прямо в БД;
Минусы:
- Для максимального удобства нужны средства автоматизации выполнения миграции;
- Неудобно добавлять комментарии к структуре БД;
##### Метод идемпотентных изменений
Не рекомендуется
![[Pasted image 20240615171705.png]]

Плюсы:
- легко устанавливать дополнительные изменения. Нужен всего лишь один файл;

Минусы:
- потенциально возможны ситуации, когда теряются данные;
- для того, чтобы изменения были идемпотентны, нужно тратить больше времени и кода на написание;