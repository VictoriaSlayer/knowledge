# Вводная
Распределенная БД находится как правило в нескольких ИС, объединенных сетью. В каждой системе своя копия СУБД, автономно обеспечивающая доступ к локальным данным. 
![[Pasted image 20250921195504.png]]
![[Pasted image 20250921195422.png]]
![[Pasted image 20250921195439.png]]

Одна из самых больших проблем в данном случае - согласованность данных. 
![[Pasted image 20250921192936.png]]
Идеальной распределенной БД является то, в которой пользователь не замечает, что данные распределены. Все они представлены так, как если бы находились в локальной системе. Поскольку такую БД создать очень трудно, элементы распределенных БД вводятся в коммерческие БД поэтапно.
Репликация БД является прекрасным решением для приложений интенсивно работающих с данными, расположенными в разных местах. Эта технология позволяет перенести данные ближе к пользователю, но за счет дополнительных затрат на синхронизацию и неполную актуальность данных. Вместе с этим возникают издержки связанные с доступом к удаленным данным - выбирая стратегию доступа к БД, следует учитывать требования бизнеса.
Существует различное множество схем репликаций.

Затраты на доступ к распределенным БД могут быть существенны. Два схожих запроса могут требовать разный сетевой траффик и разные накладные расходы, скорость запросов может быть различной в зависимости от качества оптимизации в конкретной СУБД.

Согласно IBM на данный момент имеется 4 стадии доступа к распределенным данным в их СУБД:
- удаленный запрос - каждая инструкция SQL обращается к одной удаленной БД, каждая инструкция представляет собой транзакцию. В большинстве приложений данный подход нерелевантен, т.к. летит к чертям согласованность данных
![[Pasted image 20250921193734.png]]
- удаленная транзакция - каждая инструкция SQL обращается к одной удаленной базе данных; транзакция, состоящая из нескольких инструкций, также может обращаться только к одной БД.
	На данном уровне уже могут работать приложения с распределенными БД. Например программа ввода заказов.
![[Pasted image 20250921193747.png]]
- распределенная транзакция - каждая инструкция транзакции обращается к одной удаленной БД, но транзакция в целом может обращаться к нескольким БД.
	Данному уровню соответствуют только очень сложные приложения, работающие в режиме транзакций. Например программа обработки заказов, где заказы распределены в БД нескольких складов, чтобы проверить наличие заказов.
![[Pasted image 20250921193801.png]]
- распределенный запрос - инструкция SQL может обращаться к нескольким удаленным БД; транзакция состоящая из нескольких инструкций, также может обращаться к нескольким БД
![[Pasted image 20250921193813.png]]
	Крайне сложная реализация, очень затратная и не поддерживается полностью.

## Протокол двухфазного завершения транзакций 
Если СУБД поддерживает распределенные транзакции, то она работает в режиме *все или ничего*. Или все транзакции будут завершены, или не будет завершена ни одна транзакция.
### Обычный механизм транзакций в распределенной БД
![[Pasted image 20250921194401.png]]
По итогу получаются частично согласованные (А-Б) и частично не согласованные (А-В) данные.
### Протокол двухфазного завершения транзакций
![[Pasted image 20250921194449.png]]
Системы Б и В должны быть готовы либо к завершению, либо к отмене текущей транзакции. Если СУБД может перейти в состояние готова завершить, она отвечает YES(если она так ответила, то она теряет право самостоятельно решать судьбу транзакции) , если нет, то NO. Если для системы А один из ответов будет No, или ответ не будет получен в течении определенного периода времени, то система А посылает Rollback. 

Данный метод защищает распределенную транзакцию от любой одиночной ошибки в системе Б, В или сети. Метод гарантирует целостность распределенных транзакций, но при нем значительно возрастает сетевой траффик.

## Сетевой траффик
Для экономии сетевого траффика используют:
- запуск удаленных процедур в СУБД (вместо того, чтобы гонять метод с описанием по сети, сервер запускает удаленную процедуру в СУБД). Значительно снижается сетевой траффик генерируемый приложением;
- используют CDN и кэширование данных. Различные варианты реализации, в целом выбор зависит от потребностей бизнеса;