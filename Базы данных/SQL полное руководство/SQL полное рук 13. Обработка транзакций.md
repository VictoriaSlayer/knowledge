Транзакция - последовательность инструкций образующих логическую единицу работы.
Инструкции входящие в транзакцию выполняются атомарно, как единое неделимое целое. Либо все инструкции выполняются, либо не выполняется ничего.
Руководствуемся принципом ACID.
![[Pasted image 20250913192839.png]]

![[Pasted image 20250913193000.png]]

# Журнал транзакций
## Как это работает?
![[Pasted image 20250913193459.png]]
Когда пользователь выполняет запрос на изменение базы данных, СУБД автоматически вносит в журнал транзакций одну запись для каждой строки, измененной в процессе выполнения запроса. Эта запись содержит две копии строки. Одна представляет собой копию *до* изменения, а другая - *после* изменения.
Если пользователь выполняет инструкцию COMMIT, в журнале отмечается конец транзакции. Если же пользователь выполняет инструкцию ROLLBACK, СУБД обращается к журналу и извлекает из него исходные копии строк, измененных во время транзакции, используя эти копии, СУБД возвращает строки в прежнее состояние и таким образом отменяет изменения, внесенные в БД в ходе транзакции.
## Проблема транзакций
Если с БД одновременно работают двое или более пользователей, СУБД должна гарантировать, что пользователи не будут мешать друг другу. В идеале каждый пользователь должен работать так, будто имеет монопольный доступ к БД.
Какие могут быть проблемы, когда к одним и тем же данным обращаются несколько пользователей в результате параллельных транзакций?
Ответ: разным пользователям поступают несогласованные данные. Имеются различные кейсы, как это может происходить, проще читать примеры в книге с 341, т.к. там описан полный контекст.

Чтобы решить эту проблему - различные пользователи должны видеть непротиворечивую информацию. СУБД должна гарантировать, что результаты их выполнения будут точно такими же, как и в случае, если в начале выполняется транзакция А, а затем транзакция Б.
Практически во всех СУБД для обработки параллельных транзакций применяются различные механизмы блокировки к данным к которым обращаются пользователи. 
Блокировки бывают различные:
- по типу(для всех операций CRUD, для выборочных операций);
- по степени строгости блокировки (с обеспечением совместного доступа, исключающая блокировка, частичная и т.д.);
- блокировка на уровне таблиц, страниц, строк, полей таблиц (затраты в последних двух случаях могут превышать пользу от самого факта блокировки);
![[Pasted image 20250913225338.png]]
![[Pasted image 20250913225352.png]]