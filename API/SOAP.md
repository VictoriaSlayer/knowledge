https://www.youtube.com/watch?v=egoYOP-7HBc&ab_channel=SystemsEducation
[ОЧЕНЬ ВАЖНАЯ СТАТЬЯ](https://habr.com/ru/articles/46374/)
SOAP - протокол обмена сообщениями. Чаще используется в банковской сфере.
XML поверх SOAP через HTTP.

SOAP популярнее REST, т.к. на рекламу было потрачено 200 млн. долларов. REST создал Рой Филдинг в дисертации.

Веб сервисы на основании протокола SOAP - интерфейс позволяющий взаимодействовать приложениям.

Какие форматы данных передаются в SOAP? - XML.

У REST множество ссылок endpoint'ов. Каждый раз обращаясь к эндпоинту обращаемся к одному методу.

SOAP использует RPC - remote Procedure CALL, удаленный вызов процедур:
1. один вход на сервис,
2. название процедуры, которую следует вызывать для обработки поступающих данных передаем вместе с данными.
Грубо говоря один эндпоинт в отличии множества у RESTa, который всё делает, но ему надо передать инструкции.

Формат обмена сообщениями
В SOAP используется формат SOAP XML для запросов и ответов.
В REST фиксированного формата нет. Можно использовать любой формат.

Описание сервиса
SOAP использует WSDL - язык описания веб-сервисов основанный на XML. WSDL это диалект XML.
REST не имеет стандартного языка определения сервиса.

Rest полностью не заменит SOAP т.к. есть огромное количество тяжелых, старых систем.

Вся передача данных идет по HTTP, но с некоторыми условностями:
![[Pasted image 20240207163710.png]]

С ноутбука, где запущен браузер, который является клиентом происходит запрос на промежуточный сервер, где есть приложение, которое дает ответ. Но у самого приложения нет этой инфы, оно его запросило на третьем сервере. И для второго запроса также справедливы отношения клиент-сервер.

Поверх протокола HTTP (передается не просто стандартное сообщение, а конверт с письмом, который написан на основании протокола SOAP. Сайт на ноуте запросил СОАП сервер по протоколу HTTP и вложил в конверт с письмом всю информацию. Информация на ноут пришла через посредника SOAP клиент).
Например запрос курса доллара на яндексе
Браузер - Яндекс сайт - Сайт центробанка
HTTP Клиент -SOAP клиент - SOAP сервер.
СОАП клиент и СОАП сервер обмениваются более сложной инфой, чем HTTP клиент и SOAP клиент.

### Стек протоколов веб-сервисов
Пирамида протоколов
Description - WSDL
Packaging - SOAP - еще выше
Transport - HTTP (Web) - повыше
Network - TSP/IP (Internet) - нижний уровень

WSDL, SOAP, HTTP, TSP/IP - это все варианты протоколов.

Как все эти протоколы взаимодействуют между собой?

Network (сеть) передача данных работает через TSP/IP.
Весь интернет через протокол HTTP.
В HTTP при передаче данных мы закладываем протокол SOAP.
А SOAP мы формируем по правилам WSDL.
WSDL — язык описания веб-сервисов и доступа к ним, основанный на языке XML.

То есть как в сказке про смерть Кощея. Заяц - утка - яйцо - игла.

WSDL - web services description language - язык описания веб-сервисов
SOAP - Simple object access protocol - простой протокол доступа к объектам
HTTP - hypertext transfer protocol - протокол передачи гипертекста

Протокол SOAP большой и его описание занимает много страниц.

Через сеть протоколов передается XML документ.
![[Pasted image 20240207163733.png]]

При передаче XML мы информацию заворачиваем в теги, где объясняем приложение, что передаем и кому.

В скрине вся информация, которую мы хотели передать оборачивается в тег < note> - корневой тег. В данном случае это корневой элемент.

Приложение не будет разбирать XML документ, если он неправильно составлен. Приложение будет считать, что XML повредился при доставке.

Кроме синтаксиса XML документа, сверху документа может быть XML декларация - самая первая строка, которая объясняет, что это XML

< ?xml version="1.0" encoding="utf-8" ? > - соответствует стандарту языка XML версии 1, в кодировке ютфа.

С точки зрения приложения XML представляет собой дерево с узлами
![[Pasted image 20240207164114.png]]

Аля DOM как в HTML.

Теги могут содержать атрибуты.

Теги удобно обрабатывать, когда информацию вкладываем в виде текстовых узлов внутри тегов, то это устойчиво к ошибкам, если например потеряется информация при передаче.

Для того, чтобы идентифицировать теги используется атрибут - пространство имен: xmlns="ссылка"
 

#### Пространство имен
![[Pasted image 20240207164825.png]]
Пространство имен - атрибут который указывает на семейство тегов.
Тег table относится к семейству тегов, к которому относится и width, length, name.
атрибут xmlns - атрибут который в качестве значения принимает адрес некоего сайта на котором предполагается, что описаны теги.
На скрине адрес по атрибуту xmlns зарезервирован для примеров.
### Сообщения SOAP
Контекст: при запросе сколько стоит акция фэйсбука, необходимо передать запрос с одним сообщением. 
37:34
![[Pasted image 20240207165125.png]]

В Протоколе SOAP Microsoft разработала следующую структуру: положили текстовое содержимое внутрь XML тегов.
40:28

Дерево запроса
Envelope - Body - GetQuote - Symbol - "Facebook"
тег Envelope - если отправляем сообщения по протоколу SOAP, то должен быть Envelope и Body.

<SOAP-ENV:Envelope>
</SOAP-ENV:Envelope>

SOAP-ENV - обозначает пространство имен. Теги Envelope и body относятся к нему

ns1 - пространство конкретного SOAP сервера. Фактически это эндпоинт.
getQuote - та процедура(функция), которая должна быть вызвана в SOAP сервере ns1
Facebook - входной параметр который мы передаем, он обернут в тег Symbol с атрибутами.

атрибут xsi:type - схема xsd, её также нужно знать при работе с СОАП.

Благодаря описанию в файле WSDL и клиент и сервер знают, что нужно отдать.
![[Pasted image 20240208105454.png]]

Дерево ответа
Envelope - body - getQuoteResponse - result - 252.36

Упрощенная структура SOAP протокола
![[Pasted image 20240207224452.png]]

Передача XML документов в SOAP протоколе проходит только между SOAP клиентом и SOAP сервером, в пользовательском клиенте SOAP не участвует. 

### WSDL
![[Pasted image 20240207225346.png]]
И клиент и сервер руководствуются в своей работе файлом WSDL.
И клиент и сервер читают этот файл и получают информацию как работает сервис. Описание - контракт нужен клиенту и серверу для того, чтобы разобраться как все работает. 

![[Pasted image 20240207230152.png]]

В теге operation - указывается имя операции и как должен выглядеть запрос и ответ.
Теги input и output содержат информацию о входных и выходных параметрах функции.
![[Pasted image 20240207230822.png]]
Operation - тег который описывает функцию, имя функции, входной и выходной параметр. Он не говорит, что делает функция, описывать как она работает совершенно ни к чему.

Тег binding - описывает технически, что такое этот сервис. Там много атрибутов.
Тег c - описывает, где живет сервер.

WSDL в виде дерева
![[Pasted image 20240207231409.png]]
message - содержит входной и выходной параметр
porttype - собирает вместе информацию из двух message.
binding - описывает все технические особенности сервера.
service - описание сервера.

![[Pasted image 20240208104159.png]]
Это WSDL файл, где в теге definition содержится большое количество атрибутов являющихся пространством имен. Ссылка на протоколы SOAP, WSDL и т.д.
Также есть пространство имен XSD - XML схемы. Схемы которые применяются в пространстве имён.

Как создавать файл WSDL?
Существуют разные версии WSDL, там разные структуры.
По большому счету особенности в теге Binding
Message, Porttype, Operation просто.
#### Недостатки SOAP
Использование SOAP для передачи сообщений увеличивает их объем и снижает скорость обработки.
Для SOAP нужно специально приложение, которое будет парсить XML.
#### Преимущества SOAP
Надежность (за счет отсутствия необходимости сохранять информацию о состоянии клиента, которая может быть утеряна).
Производительность (за счет использования кэша).
Масштабируемость.
Прозрачность взаимодействия между системами по сети.
Простота интерфейсов (сомнительно).
Портативность компонентов.
Легкость внесения изменений.
Способность эволюционировать, приспосабливаясь к новым требованиям.

Асинхронное взаимодействие 
Ответ о получении запроса от сервера зависит от того, как спроектирован сервер.