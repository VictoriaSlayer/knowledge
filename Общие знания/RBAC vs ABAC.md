[основа](https://habr.com/ru/companies/custis/articles/248649/)
В этой теме хотелось бы познакомить читателей с относительно новым подходом к контролю доступа под названием **Attribute-based access control**. Знакомство будет происходить на примере сравнения с популярным нынче **Role-based access control**.  
  
Когда компания состоит из одного человека, то внутренних секретов в ней нет. Единственному сотруднику доступны любые действия и любая информация.  
  
![](https://habrastorage.org/r/w1560/files/a6d/0c9/0fe/a6d0c90fe4f24ac28dc8f96bd93bb0e1.png)  
  
Если компания успешна и объемы работы растут, то наступает момент, когда один человек перестает справляться. И тогда в компанию нанимаются новые сотрудники.  
  
![](https://habrastorage.org/r/w1560/files/ab7/218/4df/ab72184df01d4e3c933b476616fe0d41.png)  
  
Но когда число сотрудников в компании увеличивается, появляются другие проблемы, например:  
  

- каждый сотрудник должен выполнять только свои бизнес-задачи и не иметь доступа к чужим;
- каждый сотрудник должен видеть только связанную со своими бизнес-задачами информацию;
- у каждой задачи должен быть ответственный за ее выполнение сотрудник.

  
Если не решить эти проблемы, фирма может понести финансовые потери из-за:  
  

- неэффективного выполнения чужих задач в силу некомпетентности;
- умышленных или неумышленных ошибок в чужих задачах;
- раскрытия информации посторонним лицам.

  
Чтобы решить эти проблемы и правильно разграничить доступ, нужно понимать, кто из сотрудников хочет выполнить действие (аутентификация) и может ли он это сделать (авторизация).  
  
![](https://habrastorage.org/r/w1560/files/e68/d45/dde/e68d45dded2f45a59af6f2adfefe472a.png)  
  
Самой сложной является проблема авторизации. Существует несколько подходов к ее решению, но наибольшее распространение на сегодняшний день получил контроль на основе ролей (role-based access control, RBAC).  
  

## Role-based access control (RBAC)

  
Суть подхода заключается в создании ролей, повторяющих бизнес-роли в компании, и присваивание их пользователям. На основе этих ролей проверяется возможность выполнения пользователем того или иного действия.  
  
Если бизнес-правила одномерны и все действия можно разбить по ролям (бухгалтер, менеджер, администратор и т. п.), такого подхода будет достаточно. Тогда одному бизнес-правилу будет соответствовать одна роль.  
  
![](https://habrastorage.org/r/w1560/files/9c3/eea/eb3/9c3eeaeb31264bf9ba8195f4eb1e705e.png)  
  
![](https://habrastorage.org/r/w1560/files/e56/b1b/131/e56b1b131fbd40778880deddcae6b976.png)  
  
Но бизнес-правила неизбежно усложняются и становятся многомерными. Это приводит к тому, что одного атрибута (роли) для выражения бизнес-правил становится недостаточно и начинают добавляться другие атрибуты (город, страна, филиал, день недели, владелец, лимит и т. п.).  
  
Чтобы справиться с этой сложностью, необходимо создавать дополнительные роли, число которых равно числу различных комбинаций всех атрибутов.  
  
![](https://habrastorage.org/r/w1560/files/087/ac1/41f/087ac141f2a54a218d421a2d08ed888d.png)  
  
![](https://habrastorage.org/r/w1560/files/b6b/e82/880/b6be82880b7f4f5bb438c07f4a946800.png)  
  
После каждого добавления нового значения атрибута придется добавлять новые роли. То есть если появится филиал «Г», то придется добавить новые роли, такие как «Администратор филиала «Г», «Менеджер филиала «Г», «Бухгалтер филиала «Г» и т. п., после чего присвоить всем требуемым сотрудникам новые роли. Все это порождает много рутинного ручного труда.  
  
Кроме этого, появляются и другие проблемы:  
  

- одно бизнес-правило «размазывается» среди множества ролей и становится неочевидным, что усложняет понимание такого правила и его поддержку;
- начинается взрывной рост числа ролей, что значительно усложняет управление ими.

  
А бизнес-правила, в которых используются атрибуты, значения которых заранее не известны и вычисляются в процессе работы, вообще невозможно выразить с помощью ролевой модели.  
  
![](https://habrastorage.org/r/w1560/files/e08/b59/225/e08b59225d394d6bbc7ad17cc9f7af6e.png)  
  
Существуют также бизнес-правила, которые ограничивают доступ не к действиям, а к данным. Такие бизнес-правила также невозможно выразить с помощью ролевой модели.  
  
![](https://habrastorage.org/r/w1560/files/456/384/360/4563843604c74c35b453c260791031ae.png)  
  
Чтобы реализовать поддержку таких бизнес-правил, придется использовать другие инструменты, что только удорожает и усложняет внедрение и сопровождение системы контроля доступа. Получается, что как только бизнес-правила становятся многомерными или требуют контроля данных, ролевая модель не только не решает текущие проблемы контроля доступа, но и создает новые.  
  

## Attribute-based access control (ABAC)

  
Чтобы справиться с нерешаемыми в рамках RBAC проблемами, был создан другой подход, который основывается на атрибутах.  
Основное отличие этого подхода в том, что каждая ситуация оценивается не с точки зрения роли пользователя и действия, которое он хочет совершить, а с точки зрения атрибутов, которые к ним относятся.  
  
Бизнес-правило, по сути, представляет собой набор условий, в которых различные атрибуты должны удовлетворять предъявляемым к ним требованиям.  
  
Можно явно выделить несколько категорий атрибутов.  
  
![](https://habrastorage.org/r/w1560/files/9a8/5c7/03b/9a85c703b2834ba696f2c47d38819d11.png)  
  
Для выполнения авторизации значения всех атрибутов берутся в момент проверки прав и сравниваются с ожидаемыми значениями. Выполнение всех условий обеспечивает доступ к ресурсу.  
  
Простые правила описываются простыми условиями.  
  
![](https://habrastorage.org/r/w1560/files/5e9/034/2a8/5e90342a8c8d49ee86a90e85be333baf.png)  
  
Многомерные правила в этой модели не становятся более сложными.  
  
![](https://habrastorage.org/r/w1560/files/1cb/49f/e1a/1cb49fe1ac844c0bb3782538d7643f22.png)  
  
При добавлении новых значений атрибутов условия бизнес-правила меняться не будут. То есть если появится филиал «Г», в условиях бизнес-правила ничего менять не придется. Все, что потребуется, — это добавить нужным сотрудникам значение атрибута «Филиал» — «Филиал «Г».  
  
Таким образом, ABAC позволяет избежать проблем, которые появляются в RBAC:  
  

- бизнес-правило не «размазывается» по системе, что делает его понимание и поддержку достаточно простыми;
- не происходит взрывного роста числа условий, что упрощает их сопровождение.

  
Но самое главное, ABAC позволяет решить проблемы, которые невозможно решить с помощью RBAC, поскольку в этом подходе нет ограничений на сложность бизнес-правил. Бизнес-правила любой сложности, в том числе с использованием заранее неизвестных атрибутов, не создают новых проблем и просты в сопровождении.  
  
![](https://habrastorage.org/r/w1560/files/c0c/5f1/bf2/c0c5f1bf268e42e99048fcc7d4e2da17.png)  
  
Представления бизнес-правила в виде набора условий удобно использовать для фильтрации данных. Часть условий можно вычислить еще до обращения к ресурсу, а оставшиеся условия становятся фильтром для выбора данных.  
  
![](https://habrastorage.org/r/w1560/files/7ad/5a7/a38/7ad5a7a3820340a39a1a7b3e7486b197.png)  
  
Первые три условия можно проверить еще до обращения к данным. А последнее условие можно использовать в качестве предиката для получения только разрешенных данных.  
  

## Сравнение ABAC и RBAC

  
![](https://habrastorage.org/r/w1560/files/d2b/fb8/e3b/d2bfb8e3b9f448f482ddb49e6fab796f.png)  
  
Как видно из сравнения, RBAC хорошо подходит только для реализации простых бизнес-правил. С увеличением сложности правил целесообразность использования RBAC уменьшается из-за растущей стоимости поддержки системы контроля доступа, а начиная с определенного уровня сложности правил этот подход вообще не дает результата.  
  
ABAC, в свою очередь, не ограничивает сложность бизнес-правил. Благодаря более понятному бизнесу и компактному выражению этот подход позволяет не увеличивать стоимость поддержки при реализации более сложных правил, а также дает возможность обеспечивать контроль доступа не только к действиям, но и к данным.  
  
P. S.: На сегодняшний день для ABAC существует стандарт XACML, который активно развивается и используется. Подробнее о нем можно узнать в [следующей](http://habrahabr.ru/company/custis/blog/258861/) статье.  
  
Интересные и полезные ссылки про ABAC, XACML и их использование:  

- [Знакомство с XACML — стандартом для Attribute-Based Access Control](http://habrahabr.ru/company/custis/blog/258861/)
- [ABAC;](http://en.wikipedia.org/wiki/Attribute-based_access_control)
- [Стандарт XACML;](https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=xacml)
- [Guide to ABAC от NIST;](http://nvlpubs.nist.gov/nistpubs/specialpublications/NIST.sp.800-162.pdf)
- [Реализация XACML от Axiomatics;](http://www.axiomatics.com/attribute-based-access-control.html)
- [WSO2 и XACML;](http://wso2.com/library/articles/2010/10/using-xacml-fine-grained-authorization-wso2-platform/)
- [Oracle WebLogic и XACML;](http://docs.oracle.com/cd/E13222_01/wls/docs92/secwlres/xacmlusing.html)
- [IBM Tivoli Security Policy Manager и XACML;](https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/Tivoli%20Security%20Policy%20Manager/page/Authorization%20Web%20Service)
- [Cisco Enterprise Policy Manager и XACML;](http://www.cisco.com/c/en/us/products/collateral/security/policy-decision-point/data_sheet_c78-453502.html)
- [Boeing и XACML;](http://www.w3.org/2009/policy-ws/papers/Tolbert.pdf)
- [PayPal и Axiomatics;](http://www.axiomatics.com/news/228-paypal-to-use-axiomatics-intelligent-access-management-solution.html)
- [Информационный ресурс;](http://xacmlinfo.org/)
- От [SadBubble](http://habrahabr.ru/users/sadbubble/): [JSON Profile of XACML 3.0.](http://docs.oasis-open.org/xacml/xacml-json-http/v1.0/xacml-json-http-v1.0.html)